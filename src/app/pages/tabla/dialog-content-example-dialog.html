<h2 mat-dialog-title>Crear encuesta</h2>

<mat-dialog-content class="mat-typography">

  <div class="container">
    <div class="row">

      <form [formGroup] = "form" (submit)="create()" >

        <div class="row mt-4">
          <div class="col-12">
            <label for="form-title" class="form-label">Titulo de la encuesta</label>
            <input type="text" class="form-control" formControlName="title">
            <ng-container *ngIf="form.get('title').touched && form.get('title').errors">
              <div class="form-text text-danger" *ngIf="form.get('title').errors.required">
                Ingresa el Título de la Encuesta
              </div>
            </ng-container>


          </div>
        </div>
        <div class="row mt-4">
          <div class="col-12">
            <label for="form-description" class="form-label">Descripción de la Encuesta</label>
            <textarea id="form-description" class="form-control" formControlName="description"></textarea>

            <ng-container *ngIf="form.get('description').touched && form.get('description').errors">
              <div class="form-text text-danger" *ngIf="form.get('description').errors.required">
                Ingresa el Descripción de la Encuesta
              </div>
            </ng-container>
          </div>
        </div>

        <div class="row my-4 align-items-center">
          <div class="col">
            <h3>Preguntas</h3>
          </div>

          <div class="col-auto">
            <button mat-fab color="primary" (click)="addQuestion()" type="button" [disabled]="form.invalid">
              <mat-icon>add</mat-icon>
            </button>
            <!-- <button class="btn btn-sm btn-outline-success" (click)="addQuestion()" type="button" [disabled]="form.invalid">Agregar Pregunta +</button> -->
          </div>
        </div>


        <!-- AGREGAR PREGUNTAS -->
        <ng-container formArrayName="questions">
          <ng-container *ngFor="let question of form.get('questions').controls; let qI = index" [formGroupName]="qI">
            <div class="card mb-4 p-3">
              <div class="row align-items-center">
                <div class="col">
                  <h4>Pregunta #{{ qI + 1 }}</h4>
                </div>

                <div class="col-auto">

                  <button mat-fab color="warn" (click)="removeQuestion(qI)" type="button">
                    <mat-icon>delete</mat-icon>
                  </button>
                  <!-- <button type="button" class="btn btn-danger btn-sm" (click)="removeQuestion(qI)">Eliminar Pregunta x</button> -->

                </div>
              </div>

              <div class="row mt-4">
                <div class="col-sm-8">
                  <label [for]="'form-title-' + qI" class="form-label">Título de la Pregunta</label>
                  <input type="text" [id]="'form-title-' + qI" class="form-control" formControlName="title">

                  <ng-container *ngIf="form.get('questions').controls[qI].get('title').touched && form.get('questions').controls[qI].get('title').errors">
                    <div class="form-text text-danger" *ngIf="form.get('questions').controls[qI].get('title').errors.required">
                      Ingresa el Título de la Pregunta
                    </div>
                  </ng-container>
                </div>

                <div class="col-sm-4">

                  <label [for]="'form-type-' + qI" class="form-label">Tipo de Pregunta</label>
                  <select [id]="'form-type-' + qI" class="form-control" formControlName="type">
                    <option [value]="1">Pregunta Abierta</option>
                    <option [value]="2">Opción Múltiple</option>
                    <option [value]="3">Si / No</option>
                  </select>

                  <ng-container *ngIf="form.get('questions').controls[qI].get('type').touched && form.get('questions').controls[qI].get('type').errors">
                    <div class="form-text text-danger" *ngIf="form.get('questions').controls[qI].get('type').errors.required">
                      Ingresa el Elige el Tipo de Pregunta
                    </div>
                  </ng-container>
                </div>

              </div>

              <ng-container formArrayName="options" *ngIf="form.get('questions').controls[qI].get('type').value == 2">
                <div class="row mt-4">
                  <div class="col">
                    <h6>Opciones</h6>
                  </div>

                  <div class="col-auto">
                    <button mat-raised-button color="primary" (click)="addOption(qI)" [disabled]="form.invalid">
                      <mat-icon>add</mat-icon>
                      Agregar Opción</button>
                  </div>
                </div>

                <div class="row mt-3">
                  <ng-container *ngFor="let option of form.get('questions').controls[qI].get('options').controls; let oI = index" [formGroupName]="oI">
                    <div class="col-sm-4 mb-4">
                      <label [for]="'form-option-' + qI + '-' + oI" class="form-label">Opción #{{ oI + 1 }}</label>

                      <div class="input-group">
                        <mat-checkbox class="example-margin" formControlName="typeOP" >
                          <mat-form-field class="example-full-width" appearance="fill">
                            <mat-label>Opción</mat-label>
                            <input matInput [id]="'form-option-' + qI + '-' + oI" class="form-control" formControlName="title" name="title">
                          </mat-form-field>
                          <!-- <input [id]="'form-option-' + qI + '-' + oI" class="form-control" formControlName="title" name="title"> -->
                        </mat-checkbox>
                        <button mat-icon-button type="button" *ngIf="oI !== 0" (click)="removeOption(qI, oI)">
                          <mat-icon>delete</mat-icon>
                        </button>
                        <!-- <button type="button" class="btn btn-danger" *ngIf="oI !== 0" (click)="removeOption(qI, oI)">x</button> -->
                      </div>


                      <ng-container *ngIf="form.get('questions').controls[qI].get('options').controls[oI].get('title').touched && form.get('questions').controls[qI].get('options').controls[oI].get('title').errors">
                        <div class="form-text text-danger" *ngIf="form.get('questions').controls[qI].get('options').controls[oI].get('title').errors.required">
                          Ingresa el Título de la Opción
                        </div>
                      </ng-container>
                    </div>
                  </ng-container>
                </div>
              </ng-container>

            </div>
          </ng-container>
        </ng-container>




         <div class="row mt-4">
          <div class="col-12 text-end">
            <button mat-raised-button class="demo-button-container" color="primary" type="submit">Crear</button>
            <button mat-raised-button mat-dialog-close >Cerrar</button>
          </div>
        </div>
      </form>

    </div>
  </div>



<!-- </mat-dialog-content>
 <mat-dialog-actions align="end">
  <button mat-button mat-dialog-close>Cerrar</button>
  <button mat-button [mat-dialog-close]="true"  color="primary" type="submit" cdkFocusInitial>Crear</button>
</mat-dialog-actions> -->


<!-- Copyright 2022 Google LLC. All Rights Reserved.
    Use of this source code is governed by an MIT-style license that
    can be found in the LICENSE file at https://angular.io/license -->